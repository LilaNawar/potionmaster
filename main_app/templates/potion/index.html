{% extends 'base.html' %} {% block content %} {% load static %}
<head>
  <link rel="stylesheet" type="text/css" href="{% static 'css/index.css' %}" />
</head>

<!-- <img class="bgImage" src="https://i.imgur.com/WbYiDIm.jpg" /> -->

<h1 class="title">MY POTIONS</h1>  
<div>
  <div class="createBtn" id="indexBtn1">
    <a href="/ingredient/index">SEE ALL INGREDIENTS</a> 
  </div>    
</br>
  <div class="createBtn" id="indexBtn2"> 
    <a href="/potion/create"><p>CREATE NEW</p></a> 
  </div>
</div>

<div class="row"> 

  <div class="column left arrowLeft">
    <img id="btnLeftPot"
      src="https://i.ibb.co/0DDjxpc/Screen-Shot-2022-04-07-at-6-38-09-PM-removebg-preview.png"
    /> 
  </div>
  <div class="column middle" id="allPotionData" data-potions="{{potions_forJS_list}}">
    <table>
      <tr class="row1"> 
      {% for potion in potions %}
      {% if forloop.counter0 < 4 %}
        <td data-potion="{{potion.id}}">
         <div class="potionBottlePic">
            <a href="{% url 'potion_detail' potion.id %}">
              <div class="nameAndIcon">
                <img id="bottleRow1" style="height: 350px" src="https://i.imgur.com/P51dKQT.png" />
                <p class="nameLabel potionName" style="text-align: center">
                  {{ potion.name }}
                </p>
                <div class="deleteButton"> <a href="{% url 'potion_delete' potion.id %}">Delete</a> </div>
             </div>
            </a>
          </div>
        </td>
      {% endif %}
      {% endfor %} 
      </tr>  

      <tr class="row2">
        {% for potion in potions %}
        {% if forloop.counter0 < 8 and forloop.counter0 > 3 %}
          <td data-potion="{{potion.id}}">
            <div class="potionBottlePic">
              <a href="{% url 'potion_detail' potion.id %}">
                <div class="nameAndIcon2">
                  <img id="bottleRow2" style="height: 350px" src="https://i.imgur.com/P51dKQT.png" />
                  <p class="nameLabel potionName" style="text-align: center">
                    {{ potion.name }}
                  </p> 
                  <div class="deleteButton"> <a href="{% url 'potion_delete' potion.id %}">Delete</a> </div>
                </div>
              </a>
            </div>
          </td>
        {% endif %}
        {% endfor %}
      </tr>
    </table>   
  </div>

  <div class="column right arrowRight">
    <img id="btnRightPot"
      src="https://i.ibb.co/FqNRmSX/Screen-Shot-2022-04-07-at-6-38-20-PM-removebg-preview.png"
    />
  </div>

</div>


<script>
  let leftBtn = document.getElementById("btnLeftPot");
  let rightBtn = document.getElementById("btnRightPot");
  leftBtn.addEventListener("click", scrollLeft);
  rightBtn.addEventListener("click", scrollRight);

  let potionDataContainer = document.getElementById("allPotionData");
  let potions_raw = potionDataContainer.getAttribute(['data-potions']);

  // console.log(potions_raw)

  let potions_fullList = [];
    p_split=potions_raw.split(",");
    for (p_str of p_split) {
      str_split=p_str.split(": ");
      for (p2_str of str_split) {
        p2_str = p2_str.replace("'","");
        p2_str = p2_str.replace("'","");
        p2_str = p2_str.replace("[","");
        p2_str = p2_str.replace("{","");
        p2_str = p2_str.replace("}","");
        p2_str = p2_str.replace("]","");
        p2_str = p2_str.trim();
        potions_fullList.push(p2_str);
      }
    }
    // console.log(potions_fullList)
    //End array with starting key to allow parser below to successfully complete each object
    potions_fullList.push(potions_fullList[0]);
    //Parse the array and move key-value apirs into objects
    let new_obj = {}
    let all_potions = [];
    for (i = 0; i<potions_fullList.length+1; i+=2) {
      if ((potions_fullList[i] === potions_fullList[0]) && (i > 0)) {
        //data keys are repeating, so begin a new object
        all_potions.push(new_obj);
        new_obj = {};
      }
      //add key and value to object
      key=potions_fullList[i];
      new_obj[key] = potions_fullList[i+1];
    }

    console.log(all_potions) //Now have all of the potion data

    all_potions.length < 8 ? (leftBtn.style.display='none', rightBtn.style.display='none') : (leftBtn.style.display='block', rightBtn.style.display='block') ; //hide arrows if less than 8 potions total



  let allPotionEl = document.querySelectorAll('td');
  let potionIdDisplayed = [];
  let displayedPotions = [];
  let count = 0;
  for (potionEL of allPotionEl) {
    displayedPotions.push(count);
    potionIdDisplayed.push(potionEL.getAttribute(['data-potion']));
    count++;
  }

  console.log(potionIdDisplayed)
  console.log(displayedPotions)

  




  // displayPotions(displayedPotions);

  function displayPotions(indices) {
    console.log('Displaying potions...')
    console.log(indices)
    for (i in indices) {
      if (all_potions[indices[i]]) {
        allPotionEl[i].querySelector('p').innerText = all_potions[indices[i]].name;
        allPotionEl[i].querySelector('p').setAttribute(['data-potion'], all_potions[indices[i]].id);
        allPotionEl[i].querySelector('a').href="potion/detail/"+all_potions[indices[i]].id;
        console.log(allPotionEl[i].querySelector('a').href)
      }
    }

    // if (all_potions[indices[0]]) {
    //   i1.style.backgroundImage = "url("+all_potions[indices[0]].image+")";
    //   i1.innerHTML = '<h5>'+all_potions[indices[0]].name+'</h5>';
    //   i1.dataset={};
    //   i1.dataset.id = all_potions[indices[0]].id;
    //   i1.dataset.name = all_potions[indices[0]].name;
    //   i1.dataset.image = all_potions[indices[0]].image;
    // }
  }

  function scrollLeft(ev) {
    console.log('left')
    displayedPotions=displayedPotions.map(v=>{
      v-=1;
      if (v < 0) {
        v = all_potions.length - 1;
      }
      return v
    });
    displayPotions(displayedPotions);
  }

  function scrollRight(ev) {
    console.log('right')
    displayedPotions=displayedPotions.map(v=>{
      v+=1;
      if (v > all_potions.length - 1) {
        v = 0;
      }
      return v
    });
    displayPotions(displayedPotions);
  }
</script>


{% endblock %}
